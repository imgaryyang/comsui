webpackJsonp([21,23],{5:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(31),a=n(1),o=function(e,t){var n={};return Object.keys(t).forEach(function(s){if(e.hasOwnProperty(s)){var a=t[s];if("string"==typeof a&&""!==a)try{/^\[[\s\S]*\]$/.test(a)&&(a=JSON.parse(a))}catch(e){}n[s]=a}}),n};t.default={data:function(){return{listenConditionChange:!1}},computed:{conditions:function(){var e=(0,a.filterQueryConds)(this.queryConds);return Object.assign({},e,this.comboConds,this.sortConds,this.pageConds)},filterConds:function(){return Object.assign({},this.queryConds,this.comboConds)}},watch:{initializing:function(e){e?this.initializeLoading=this.$loading({text:"正在初始化",target:this.$el}):this.initializeLoading&&this.initializeLoading.close()}},activated:function(){this.disableGlobalQueryCache=!0,this.setRouteQueryListener(),this.initializing||this.setChangeListener(),this.initializing||this.equalTo((0,a.purify)(this.lastRouteQuery),(0,a.purify)(this.$route.query))||(this.disableGlobalQueryCache?this.extractFromQuery(this.mergeDefaultQuery(this.$route.query)):this.extractFromQuery(this.mergeDefaultQuery(this.$store.state.query,this.$route.query)),this.dataSource.list=[],this.dataSource.size=0,this.dataSource.error="",this.dataSource.fetching=!1,(this.autoload!==!1||this.existRouteQueryExceptTimestamp())&&this.fetch())},deactivated:function(){this.unsetRouteQueryListener(),this.unsetChangeListener()},beforeRouteLeave:function(e,t,n){this.disableGlobalQueryCache||this.$store.commit(s.SET_CACHE_QUERY,JSON.parse(JSON.stringify(this.conditions))),this.lastRouteQuery=this.$route.query,n()},methods:{unsetRouteQueryListener:function(){"function"==typeof this.unwatchRouteQuery&&this.unwatchRouteQuery(),this.unwatchRouteQuery=null},setRouteQueryListener:function(){var e=this;this.unwatchRouteQuery||(this.unwatchRouteQuery=this.$watch("$route.query",function(t,n){e.dataSource.list=[],e.dataSource.size=0,e.dataSource.error="",e.dataSource.fetching=!1,e.extractFromQuery(e.mergeDefaultQuery(t))}))},unsetChangeListener:function(){"function"==typeof this.unwatchConditions&&this.unwatchConditions(),this.unwatchConditions=null,"function"==typeof this.unwatchFilterConds&&this.unwatchFilterConds(),this.unwatchFilterConds=null,"function"==typeof this.unwatchSortConds&&this.unwatchSortConds(),this.unwatchSortConds=null,"function"==typeof this.unwatchPageConds&&this.unwatchPageConds(),this.unwatchPageConds=null},setChangeListener:function(){var e=this;setTimeout(function(){e.unwatchConditions||(e.unwatchConditions=e.$watch("conditions",function(t,n){e.previousConditions=n},{deep:!0})),e.listenConditionChange===!1||e.unwatchFilterConds||(e.unwatchFilterConds=e.$watch("filterConds",function(){e.pageConds&&(e.pageConds.pageIndex=1),e.fetch()},{deep:!0})),e.sortConds&&!e.unwatchSortConds&&(e.unwatchSortConds=e.$watch("sortConds",function(t,n){e.fetch()},{deep:!0})),e.pageConds&&!e.unwatchPageConds&&(e.unwatchPageConds=e.$watch("pageConds",function(t,n){e.fetch()},{deep:!0}))},0)},_initialize:function(){var e=this;this.initializing=!0,this.initialize().then(function(){e.$refs.lookup&&e.$refs.lookup.$on("click",function(){e.pageConds&&(e.pageConds.pageIndex=1),e.fetch()}),e.defaultConditions=Object.assign({},e.conditions),e.disableGlobalQueryCache?e.extractFromQuery(e.mergeDefaultQuery(e.$route.query)):e.extractFromQuery(e.mergeDefaultQuery(e.$store.state.query,e.$route.query)),e.initializing=!1,e.$emit("ready")})},onSortChange:function(e){var t=(e.column,e.prop),n=e.order;this.sortConds.sortField=t,this.sortConds.isAsc=n},mergeDefaultQuery:function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this.defaultConditions),e.unshift({}),Object.assign.apply(Object,e)},mergeLastQuery:function(){},extractFromQuery:function(e){this.pageConds&&(this.pageConds=Object.assign({},this.pageConds,o(this.pageConds,e))),this.queryConds&&(this.queryConds=Object.assign({},this.queryConds,o(this.queryConds,e))),this.comboConds&&(this.comboConds=Object.assign({},this.comboConds,o(this.comboConds,e))),this.sortConds&&(this.sortConds=Object.assign({},this.sortConds,o(this.sortConds,e)))}}}},715:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),o=s(a),i=n(5),r=s(i),l=n(1),u=n(2),d=s(u);t.default={mixins:[o.default,r.default],data:function(){return{action:"/message/query",pageConds:{perPageRecordNumber:12,pageIndex:1},queryConds:{clientId:"",allowedSendStatus:"",smsTemplateEnum:"",startDate:"",endDate:""},allowedSendFlag:"",smsTemplateEnumList:[]}},methods:{initialize:function(){var e=this;return(0,l.ajaxPromise)({url:"/message/options"}).then(function(t){e.allowedSendFlag=t.allowedSendFlag,e.smsTemplateEnumList=t.smsTemplateEnumList}).catch(function(e){d.default.open(e)})},handleChangeAllowSend:function(){var e=this;d.default.open("是否确认改变自动允许发送状态！",null,[{text:"取消",handler:function(){return d.default.close()}},{text:"继续",type:"success",handler:function(){(0,l.ajaxPromise)({type:"post",url:"/message/changeAllowSend",data:{allowedSendFlag:e.allowedSendFlag}}).then(function(t){e.allowedSendFlag=!e.allowedSendFlag,d.default.open("操作成功！")}).catch(function(e){d.default.open(e)})}}])},handleSendSuccSms:function(){var e=this;d.default.open("是否确认一键发送所有未发送的成功扣款短信！",null,[{text:"取消",handler:function(){return d.default.close()}},{text:"继续",type:"success",handler:function(){(0,l.ajaxPromise)({type:"post",url:"/message/sendSuccSms"}).then(function(t){d.default.once("closed",e.fetch),d.default.open("操作成功！")}).catch(function(e){d.default.open(e)})}}])},handleDeleteNotSuccSms:function(){var e=this;d.default.open("是否确认删除所有非成功未允许发送短信！",null,[{text:"取消",handler:function(){return d.default.close()}},{text:"继续",type:"success",handler:function(){(0,l.ajaxPromise)({type:"post",url:"/message/deleteNotSuccSms"}).then(function(t){d.default.once("closed",e.fetch),d.default.open("操作成功！")}).catch(function(e){d.default.open(e)})}}])},handleActivate:function(e){var t=this;(0,l.ajaxPromise)({type:"post",url:"/message/activate",data:{smsQueneId:e}}).then(function(e){t.fetch(),e.message?d.default.open(e.message):void 0}).catch(function(e){d.default.open(e)})},handleReSend:function(e){var t=this;(0,l.ajaxPromise)({type:"post",url:"/message/reSend",data:{smsQueneId:e}}).then(function(e){t.fetch(),e.message?d.default.open(e.message):void 0}).catch(function(e){d.default.open(e)})}}}},1592:function(e,t,n){var s,a;s=n(715);var o=n(1747);a=s=s||{},"object"!=typeof s.default&&"function"!=typeof s.default||(a=s=s.default),"function"==typeof a&&(a=a.options),a.render=o.render,a.staticRenderFns=o.staticRenderFns,e.exports=s},1747:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content"},[n("div",{staticClass:"scroller"},[n("div",{staticClass:"query-area"},[n("el-form",{staticClass:"sdf-form sdf-query-form",attrs:{inline:!0}},[n("el-form-item",[n("el-input",{attrs:{size:"small",placeholder:"客户编号",value:e.queryConds.clientId},nativeOn:{change:function(t){e.queryConds.clientId=t.target.value}}})]),e._v(" "),n("el-form-item",[n("el-select",{directives:[{name:"model",rawName:"v-model",value:e.queryConds.allowedSendStatus,expression:"queryConds.allowedSendStatus"}],attrs:{placeholder:"发送状态",size:"small"},domProps:{value:e.queryConds.allowedSendStatus},on:{input:function(t){e.queryConds.allowedSendStatus=t}}},[n("el-option",{attrs:{label:"所有",value:-1}}),e._v(" "),n("el-option",{attrs:{label:"已允许",value:1}}),e._v(" "),n("el-option",{attrs:{label:"未允许",value:0}})])]),e._v(" "),n("el-form-item",[n("el-select",{directives:[{name:"model",rawName:"v-model",value:e.queryConds.smsTemplateEnum,expression:"queryConds.smsTemplateEnum"}],attrs:{placeholder:"所有短信",clearable:"",size:"small"},domProps:{value:e.queryConds.smsTemplateEnum},on:{input:function(t){e.queryConds.smsTemplateEnum=t}}},e._l(e.smsTemplateEnumList,function(e){return n("el-option",{attrs:{label:e.value,value:e.key}})}))]),e._v(" "),n("el-form-item",[n("el-col",{attrs:{span:11}},[n("el-form-item",[n("DateTimePicker",{directives:[{name:"model",rawName:"v-model",value:e.queryConds.startDate,expression:"queryConds.startDate"}],attrs:{"end-date":e.queryConds.endDate,placeholder:"创建起始日期",size:"small"},domProps:{value:e.queryConds.startDate},on:{input:function(t){e.queryConds.startDate=t}}})])]),e._v(" "),n("el-col",{attrs:{span:2}},[n("div",{staticClass:"text-align-center color-dim"},[e._v("至")])]),e._v(" "),n("el-col",{attrs:{span:11}},[n("el-form-item",[n("DateTimePicker",{directives:[{name:"model",rawName:"v-model",value:e.queryConds.endDate,expression:"queryConds.endDate"}],attrs:{"start-date":e.queryConds.startDate,placeholder:"创建终止日期",size:"small"},domProps:{value:e.queryConds.endDate},on:{input:function(t){e.queryConds.endDate=t}}})])])]),e._v(" "),n("el-form-item",[n("el-button",{ref:"lookup",attrs:{size:"small",type:"primary"}},[e._v("查询")])])])]),e._v(" "),n("div",{staticClass:"table-area"},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.dataSource.fetching,expression:"dataSource.fetching"}],staticClass:"no-table-bottom-border",attrs:{stripe:"",data:e.dataSource.list}},[n("el-table-column",{attrs:{label:"客户编号",prop:"smsQuene.clientId"}}),e._v(" "),n("el-table-column",{attrs:{label:"短信类型",prop:"smsTemplate.title"}}),e._v(" "),n("el-table-column",{attrs:{"min-width":"250px",label:"短信内容",prop:"smsQuene.content"}}),e._v(" "),n("el-table-column",{attrs:{label:"合作商户号",prop:"smsQuene.platformCode"}}),e._v(" "),n("el-table-column",{attrs:{label:"创建时间",prop:"smsQuene.createTime"},inlineTemplate:{render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._v(e._s(e._f("formatDate")(e.row.smsQuene.createTime)))])},staticRenderFns:[]}}),e._v(" "),n("el-table-column",{attrs:{label:"请求时间",prop:"smsQuene.requestTime"},inlineTemplate:{render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._v(e._s(e._f("formatDate")(e.row.smsQuene.requestTime)))])},staticRenderFns:[]}}),e._v(" "),n("el-table-column",{attrs:{label:"响应时间",prop:"smsQuene.responseTime"},inlineTemplate:{render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._v(e._s(e._f("formatDate")(e.row.smsQuene.responseTime)))])},staticRenderFns:[]}}),e._v(" "),n("el-table-column",{attrs:{label:"响应结果",prop:"smsQuene.responseTxt"}}),e._v(" "),n("el-table-column",{attrs:{label:"允许发送",prop:"smsQuene.allowedSendStatus"},inlineTemplate:{render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._v(e._s(e.row.smsQuene.allowedSendStatus?"是":"否"))])},staticRenderFns:[]}}),e._v(" "),n("el-table-column",{attrs:{label:"发送状态",prop:"smsQuene.smsSendStatus"},inlineTemplate:{render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",["WAITING_SEND"==e.row.smsQuene.smsSendStatus?n("span",[e._v("待发送")]):"SUCCESS"==e.row.smsQuene.smsSendStatus?n("span",[e._v("成功")]):"FAILURE"==e.row.smsQuene.smsSendStatus?n("span",[e._v("失败")]):e._e(),e._v(" "),e._v(" ")])},staticRenderFns:[]}}),e._v(" "),n("el-table-column",{attrs:{label:"操作"},inlineTemplate:{render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.ifElementGranted("send-message")&&0==e.row.smsQuene.allowedSendStatus?n("a",{attrs:{href:"javascript: void 0;"},on:{click:function(t){e.handleActivate(e.row.smsQuene.id)}}},[e._v("发送")]):e._e(),e._v(" "),2==e.row.smsQuene.smsSendStatus?n("a",{attrs:{href:"javascript: void 0;"},on:{click:function(t){e.handleReSend(e.row.smsQuene.id)}}},[e._v("重发")]):e._e()])},staticRenderFns:[]}})])])]),e._v(" "),n("div",{staticClass:"operations"},[n("div",{staticClass:"pull-left"},[e.ifElementGranted("open-message-function")?n("span",[e._v("自动发送："),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleChangeAllowSend}},[e._v(e._s(e.allowedSendFlag?"是（点击关闭）":"否（点击开启）"))])]):e._e(),e._v(" "),e.ifElementGranted("if-send-failed-message")?n("span",[n("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSendSuccSms}},[e._v("发送所有未发送的成功短信")])]):e._e(),e._v(" "),e.ifElementGranted("if-delete-failed-message")?n("span",[n("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleDeleteNotSuccSms}},[e._v("删除所有非成功未允许发送短信")])]):e._e()]),e._v(" "),n("div",{staticClass:"pull-right"},[n("PageControl",{directives:[{name:"model",rawName:"v-model",value:e.pageConds.pageIndex,expression:"pageConds.pageIndex"}],attrs:{size:e.dataSource.size,"per-page-record-number":e.pageConds.perPageRecordNumber},domProps:{value:e.pageConds.pageIndex},on:{input:function(t){e.pageConds.pageIndex=t}}})])])])},staticRenderFns:[]}}});