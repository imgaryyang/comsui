define(function(require,exports,module){var t=require("./pageControl"),e=require("scaffold/util"),a=jQuery,i=global_const.loadingImg,r=e.extractValueFromDifferentDom,s=Backbone.View.extend({events:{"click .redirect,.prev,.next,.first-page,.last-page":"onClickPageNavigateBtn","click #lookup":"query","click .check-box":"onClickCheckbox","change .lookup-params":function(t){a(t.target).parents(".operations").length||a(t.target).is("[autoquery=false]")||this.query()}},initialize:function(e){if(this.tableListEl=this.$("table[data-action]"),this.lookupParamsEl=this.$(".lookup-params"),this.rowNum=this.tableListEl.find("thead th").length,e.template&&(this.template=e.template),e.queryAction&&(this.queryAction=e.queryAction),"function"!=typeof this.template){var r=this.$(".template").html()||"";this.template=_.template(r)}this.queryAction||(this.queryAction=this.tableListEl.data("action")),this.template&&this.queryAction&&(this.pageControl=new t(a.extend({el:this.$(".page-control").get(0),url:this.queryAction},_.omit(e,"el","template"))),this.listenTo(this.pageControl,"next:pagecontrol prev:pagecontrol redirect:pagecontrol",this.refreshTableDataList),this.listenToOnce(this.pageControl,"request",function(){var t='<tr><td style="text-align: center;" colspan="'+this.rowNum+'"></td></tr>',e=a(t).find("td").html(i.clone());this.tableListEl.find("tbody").html(e)}),this.initCheckOperate(),this.getFirstData())},initCheckOperate:function(){var t=this,e=function(t,e){for(var a=0;a<t.length;a++){var i=t.eq(a);i.is(":disabled")||i.is(".disabled")||(i[0].checked=e)}};this.on("checkall.tablelist",function(a,i){var r=t.$(".check-box");e(r,a),t.trigger("checkbox.all",a,i)}),this.on("checkitem.tablelist",function(a,i){if(a===!1){var r=t.$(".check-box-all");e(r,a)}t.trigger("checkbox.item",a,i)})},refreshTableDataList:function(t,e,a,i){if(this.template){var r;r=t.length<1?'<tr class="nomore"><td style="text-align: center;" colspan="'+this.rowNum+'">没有更多数据</td></tr>':this.template({list:this.polish(t)}),this.tableListEl.find("tbody").html(r),this.trigger("refresh",t,e,a,i)}},collectQueryParams:function(t){for(var e=this.lookupParamsEl.find(".real-value"),i=0,s=e.length;i<s;i++)a.extend(t,r(e.eq(i)));return t},collectSortParams:function(t){var e=this.tableListEl.find("thead .sort"),i={};return a.each(e,function(t,e){var r=a(e),s=r.data("paramname"),l=r.hasClass("desc")?"DESC":r.hasClass("asc")?"ASC":"";s&&l&&(i[s]=l)}),a.extend(t,i),t},collectParams:function(){var t={};return this.collectQueryParams(t),this.collectSortParams(t),t},getFirstData:function(){var t=this.collectParams();this.pageControl.redirect(1,t)},query:function(){var t=this.collectParams();this.pageControl.redirect(1,t),this.trigger("page:change")},queryCurrentPage:function(){var t=this.collectParams();this.pageControl.redirect(this.pageControl.getCurrentPageIndex(),t),this.trigger("page:change")},queryPrevPage:function(){var t=this.collectParams();this.pageControl.prev(t),this.trigger("page:change")},polish:function(t){return t},onClickPageNavigateBtn:function(t){t.preventDefault();var e=a(t.target),i=this.collectParams();e.hasClass("prev")?this.pageControl.prev(i):e.hasClass("next")?this.pageControl.next(i):e.hasClass("redirect")?this.pageControl.importPageIndexRedirect(i):e.hasClass("first-page")?this.pageControl.first(i):e.hasClass("last-page")&&this.pageControl.last(i),this.trigger("page:change")},checkAll:function(t,e){this.allChecked=t,this.trigger("checkall.tablelist",t,e)},checkItem:function(t,e){this.itemChecked=t,this.trigger("checkitem.tablelist",t,e)},onClickCheckbox:function(t){var e=t.target.checked,i=a(t.target);i.is(".check-box-all")?this.checkAll(e,i):this.checkItem(e,i)}});s.find=function(t,e){for(var i=this,r=a(e||document).find(t),s=0;s<r.length;s++){var l=r.eq(s),n=l.data("pagination");n||l.data("pagination",new i({el:l[0]}))}},module.exports=s});