define(function(require,exports,module){var t=require("component/popupTip"),i=require("baseView/baseFormView"),e=require("component/pagination"),s=require("component/dialogView"),n=i.FormDialogView,a=i.BaseFormView,o=require("view/yunxin/user-role/user-role-entity").UserRoleModel,h=global_config.root,l=e.extend({queryAction:h+"/bind-financial-contract/query",template:_.template($("#template2").html()),refreshTableDataList:function(t,i,e,s){if(this.template){var n;t.length<1?1!=s.pageIndex?this.queryPrevPage():n='<thead><tr><th class="hide">全选</th><th>信托产品代码</th><th>信托合同名称</th><th>信托商户名称</th><th>信托合同类型</th><th>状态</th><th width="60">操作</th></tr></thead><tbody><tr class="nomore"><td style="text-align: center;" colspan="10">没有更多数据</td></tr></tbody>':n=this.template({list:this.polish(t)}),null!==n&&(this.tableListEl.html(n),this.trigger("refresh",t,i,e,s))}}}),d=n.extend({template:_.template($("#businessBindTmpl").html()),className:"modal fade form-modal large-form-modal",initialize:function(){d.__super__.initialize.apply(this,arguments),this.idList=[],this.pagination=new l({el:this.$(".bind-list")}),this.listenTo(this.pagination,"page:change",function(){this.idList=[]}),this.listenTo(this.pagination,"checkbox.item",function(t,i){var e=i.parents("tr").data("id");t?this.idList.push(e):this.idList=_.without(this.idList,e)}),this.listenTo(this.pagination,"checkbox.all",function(t,i){if(this.idList=[],t)for(var e=this.$(".check-box"),s=1;s<e.length;s++){var n=e.eq(s).parents("tr").data("id");this.idList.push(n)}}),this.listenTo(this.model,"model:bind",function(i){0==i.code?(this.idList=[],this.pagination.queryCurrentPage(),this.model.trigger("model:bind-result")):t.show(i.message)})},events:{"click .bind":"onClickBind","click .bind-all-item":"onClickBindAllItem"},onClickBindAllItem:function(){this.idList.length>0?this.model.bind(this.idList):t.show("请先选择需要解除绑定项")},onClickBind:function(t){this.idList=[];var i=$(t.target).parents("tr").data("id");this.idList.push(i),this.model.bind(this.idList)}}),r=e.extend({refreshTableDataList:function(t,i,e,s){if(this.template){var n;t.length<1?1!=s.pageIndex?this.queryPrevPage():(n='<thead><tr><th class="hide">全选</th><th>信托产品代码</th><th>信托合同名称</th><th>信托商户名称</th><th>信托合同类型</th><th>状态</th><th width="60">操作</th></tr></thead><tbody><tr class="nomore"><td style="text-align: center;" colspan="10">没有更多数据</td></tr></tbody>',$(".has-bind").hide()):($(".has-bind").show(),n=this.template({list:this.polish(t)})),null!==n&&(this.tableListEl.html(n),this.trigger("refresh",t,i,e,s))}}}),c=a.extend({el:".content",events:{"click .add-bind":"onClickAddBind","click .drawer":"onClickDrawer","click .unbind":"onClickUnbind","click .unbind-all-item":"onClickUnbindAll","change [name = role]":"onChangeRole"},initialize:function(i){c.__super__.initialize.apply(this,arguments),this.userId=i,this.idList=[],this.defineValidator(),this.model=new o({userId:this.userId}),this.pagination=new r({el:".has-bind"}),this.listenTo(this.model,"model:unbind",function(i){0==i.code?this.pagination.queryCurrentPage():t.show(i.message)}),this.listenTo(this.model,"model:submit",function(i){var e=this;if(0==i.code){var n=new s({bodyInnerTxt:"编辑成功",isShowCancelBtn:!1});n.on("goahead",function(){window.location.href=h+"/show-user-role/"+e.userId}),n.show()}else t.show(i.message)}),this.listenTo(this.pagination,"checkbox.item",function(t,i){var e=i.parents("tr").data("id");t?this.idList.push(e):this.idList=_.without(this.idList,e)}),this.listenTo(this.pagination,"checkbox.all",function(t,i){if(this.idList=[],t)for(var e=this.$(".check-box"),s=1;s<e.length;s++){var n=e.eq(s).parents("tr").data("id");this.idList.push(n)}}),this.listenTo(this.pagination,"page:change",function(){this.idList=[]}),this.listenTo(this.model,"model:bind-result",function(){this.pagination.query()})},onClickUnbindAll:function(){this.idList.length>0?this.showUnbindDialog(this.idList):t.show("请先选择需要解除绑定项")},onClickUnbind:function(t){var i=$(t.target).parents("tr").data("id");this.idList.splice(0),this.idList.push(i),this.showUnbindDialog(this.idList)},showUnbindDialog:function(t){var i=this,e=new s({bodyInnerTxt:"确认解除绑定？"});e.on("goahead",function(){i.model.unbind(t),this.hide()}),e.show()},defineValidator:function(){this.validator=this.$("form").validate({rules:{realname:"required",companyId:"required",role:"required"}})},validate:function(){return this.validator.form()},onClickAddBind:function(t){t.preventDefault();var i=new d({model:this.model});i.show()},onClickDrawer:function(t){t.preventDefault();var i=$(t.target);if(i.hasClass("msg")){var e=i.next();e.hasClass("active")?i.text("展开"):i.text("收起"),e.toggleClass("active"),i.closest("div").next().toggle()}else if(i.hasClass("icon-up-down"))i.hasClass("active")?i.prev().text("展开"):i.prev().text("收起"),i.toggleClass("active"),i.closest("div").next().toggle();else{var s=i.find(".icon-up-down").first(),n=s.hasClass("active"),a=i.find(".msg").first();n?a.text("展开"):a.text("收起"),s.toggleClass("active"),i.parent().next().toggle()}},submitHandler:function(){this.validate()&&this.model.submit(this.extractDomData())},onChangeRole:function(t){var i=$(t.target).find("option:selected").val();"ROLE_TRUST_OBSERVER"==i?$(".bind-view").removeClass("hide"):$(".bind-view").addClass("hide")}});module.exports=c});