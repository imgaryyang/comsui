define(function(require,exports,module){var e=require("component/popupTip"),t=require("baseView/baseFormView"),a=require("component/dialogView"),i=(t.FormDialogView,t.BaseFormView),n=(require("component/pagination"),global_config.root),o=i.extend({el:".content",events:{"click .add-bind":"onClickAddBind","click .drawer":"onClickDrawer","click .remove":"onClickRemove"},initialize:function(){this.defineValidator(),this.model=new Backbone.Model},defineValidator:function(){$.validator.addMethod("rightUserName",function(e,t){return this.optional(t)||/^[a-zA-Z][a-zA-Z0-9_]{5,15}$/.test(e)},"请输入英文字母开头、可选择英文字母数字以及下划线组合的用户名"),this.validator=this.$("form").validate({rules:{username:{required:!0,minlength:6,maxlength:16,rightUserName:!0,remote:{type:"get",url:n+"create-user-role/username",dataType:"json",dataFilter:function(e,t){var a=JSON.parse(e);return 0==a.code}}},realname:"required",companyId:"required",role:"required"},messages:{username:{remote:"当前用户名已存在",minlength:"用户名不得少于6个字符",maxlength:"用户名最多16个字符"}}})},validate:function(){return this.validator.form()},onClickRemove:function(e){},onClickDrawer:function(e){e.preventDefault();var t=$(e.target);if(t.hasClass("msg")){var a=t.next();a.hasClass("active")?t.text("展开"):t.text("收起"),a.toggleClass("active"),t.closest("div").next().toggle()}else if(t.hasClass("icon-up-down"))t.hasClass("active")?t.prev().text("展开"):t.prev().text("收起"),t.toggleClass("active"),t.closest("div").next().toggle();else{var i=t.find(".icon-up-down").first(),n=i.hasClass("active"),o=t.find(".msg").first();n?o.text("展开"):o.text("收起"),i.toggleClass("active"),t.parent().next().toggle()}},onClickAddBind:function(e){},submitHandler:function(){this.validate()&&this.save()},extractDomData:function(){var e=this._extractDomData(this.$(".real-value"));return e},save:function(){var t=this,i={type:"post",dataType:"json",url:n+"/create-user-role",data:t.extractDomData()};i.success=function(t){if(0==t.code){var i=new a({bodyInnerTxt:t.message,isShowCancelBtn:!1});i.on("goahead",function(){window.location.href=n+"/show-user-list",this.hide()}),i.show()}else e.show(t.message)},$.ajax(i)}});module.exports=o});