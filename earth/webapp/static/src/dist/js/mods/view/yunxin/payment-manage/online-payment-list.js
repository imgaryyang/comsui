define(function(require,exports,module){var t=require("baseView/tableContent"),o=jQuery,a=(o("body"),global_config.root),s=["{% if ((+size) >= 5) { %}",'    <h3 class="title" style="padding: 8px 14px; margin: -9px -14px 9px; font-size: 14px; background-color: #f7f7f7; border-bottom: 1px solid #ebebeb; border-radius: 5px 5px 0 0;">统计数量前5的银行</h3>',"{% } %}","{% _.each(dataMap, function(val, key) { %}",'    <div className="item clearfix" style="width: 180px">','        <span class="left">{%= key %}</span>','        <span class="right pull-right">{%= val %}条</span>',"    </div>","{% }) %}"].join("");module.exports=t.extend({dataStatisticsTemplate:_.template(s),events:{"click .pagecontrol-show-popover":"onClickShowPopover"},actions:{getDataStatistics:a+"/payment-manage/payment/dataStatistics"},initialize:function(){this.constructor.__super__.initialize.apply(this,arguments),this.$showPopover=this.$(".pagecontrol-show-popover"),this.$showStatisticalAmountPopover=o(".statistical-amount"),this.listenTo(this,"show-popover:amountStatistics",this.showAmountStatisticsPopover),this.on("fetch:dataStatistics",function(t){var o=this.$showPopover.data("bs.popover");0==t.code?(t.data.size>=5&&(o.options.content="统计数量前5的银行"),0===t.data.size?o.options.content="没有统计数据":o.options.content=this.dataStatisticsTemplate(t.data)):o.options.content=t.message,this.$showPopover.popover("show")})},showAmountStatisticsPopover:function(t){t&&this.queryAmountStatistics()},queryAmountStatistics:function(){var t=this.collectParams(),a={dataType:"json",url:global_config.root+"/payment-manage/payment/amountStatistics",data:t};a.success=function(t){var o=this.$showStatisticalAmountPopover.data("bs.popover");if(0==t.code){var a=0;_.isEmpty(t.data)||(a=t.data.transferAmount.formatMoney(2,""));var s='<div><span class="text-muted">代扣金额:</span>'+a+"</div>";o.options.content=s}else o.options.content=t.message;this.$showStatisticalAmountPopover.popover("show")}.bind(this),o.ajax(a)},getDataStatistics:function(){var t={url:this.actions.getDataStatistics,data:this.collectParams(),dataType:"json"};t.success=function(t){this.trigger("fetch:dataStatistics",t)}.bind(this),o.ajax(t)},onClickShowPopover:function(t){this.destroyOtherPopover();var a=o(t.target);a.popover(),a.data("bs.popover").options.content="数据统计中...",a.popover("show"),this.getDataStatistics()}})});