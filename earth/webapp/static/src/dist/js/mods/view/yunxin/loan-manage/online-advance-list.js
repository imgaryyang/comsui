define(function(require,exports,module){var t=require("baseView/tableContent"),o=require("component/popupTip"),e=jQuery,a=(e("body"),global_config.root),i=["{% if ((+size) >= 5) { %}",'    <h3 class="title" style="padding: 8px 14px; margin: -9px -14px 9px; font-size: 14px; background-color: #f7f7f7; border-bottom: 1px solid #ebebeb; border-radius: 5px 5px 0 0;">统计数量前5的收款方银行</h3>',"{% } %}","{% _.each(dataMap, function(val, key) { %}",'    <div className="item clearfix" style="width: 180px">','        <span class="left">{%= key %}</span>','        <span class="right pull-right">{%= val %}条</span>',"    </div>","{% }) %}"].join(""),s=t.extend({dataStatisticsTemplate:_.template(i),events:{"click .icon-bankcard":"onClickBankcard","mouseover .showPopover":"showPopover","mouseout .showPopover":"showPopover","click #exportData":"onClickExportData","click .pagecontrol-show-popover":"onClickPageControlShowPopover"},actions:{export:a+"/capital/plan/execlog/export",getDataStatistics:a+"/capital/plan/execlog/dataStatistics",execlogAmountStatistics:a+"/capital/plan/execlog/amountStatistics"},initialize:function(){this.$showPopover=this.$(".pagecontrol-show-popover"),this.$amountStatisticsPopover=e(".statistical-amount"),this.listenTo(this,"show-popover:amountStatistics",this.showAmountStatisticsPopover),this.on("fetch:dataStatistics",function(t){var o=this.$showPopover.data("bs.popover");0==t.code?(t.data.size>=5&&(o.options.title="统计数量前5的银行"),0===t.data.size?o.options.content="没有统计数据":o.options.content=this.dataStatisticsTemplate(t.data)):o.options.content=t.message,this.$showPopover.popover("show")}),s.__super__.initialize.apply(this,arguments)},getDataStatistics:function(){var t={url:this.actions.getDataStatistics,data:this.collectParams(),dataType:"json"};t.success=function(t){this.trigger("fetch:dataStatistics",t)}.bind(this),e.ajax(t)},showAmountStatisticsPopover:function(t){t&&this.queryAmountStatistics()},queryAmountStatistics:function(){var t=this.collectParams(),o={type:"post",dataType:"json",url:this.actions.execlogAmountStatistics,data:t};o.success=function(t){if(0==t.code){var o=0;_.isEmpty(t.data)||(o=t.data.remittanceAmount.formatMoney(2,""));var e=this.$amountStatisticsPopover.data("bs.popover"),a='<div><span class="text-muted">放款金额:</span>'+o+"</div>";e.options.content=a}else e.options.content=t.message;this.$amountStatisticsPopover.popover("show")}.bind(this),e.ajax(o)},showPopover:function(t){var o=e(t.target),a=o.siblings(".account").html();o.popover({content:a}),o.popover("toggle")},onClickPageControlShowPopover:function(t){var o=e(t.target);this.destroyOtherPopover(),o.popover(),o.data("bs.popover").options.content="数据统计中...",o.popover("show"),this.getDataStatistics()},onClickBankcard:function(t){t.preventDefault(),this.showPopover(t);var o=e(t.target);return o.on("shown.bs.popover",function(){e("body").find(".popover").last().addClass("clickShow")}),o.on("hidden.bs.popover",function(){o.removeClass("active")}),o.on("hide.bs.popover",function(){o.removeClass("active")}),o.toggleClass("active"),!1},checkDate:function(){var t=e(".starttime-datepicker").last(),a=t.find(".datetimepicker-form-control").first().val();if(_.isEmpty(a))return o.show("请选择起始日期"),!1;var i=e(".endtime-datepicker").last(),s=i.find(".datetimepicker-form-control").first().val(),n=new Date(a),c=new Date(s),p=c.getTime()-n.getTime();return!(p>6048e5)||(o.show("不允许时间间隔超过7天"),!1)},onClickExportData:function(t){if(t.preventDefault(),this.checkDate()){var i=e("#myForm").serialize(),s={url:this.actions.export,type:"post",dataType:"json",data:i};s.success=function(t){0==t.code?window.location.href=a+"/report/export?reportId=9&"+i:o.show(t.message)},e.ajax(s)}}});module.exports=s});