define(function(require,exports,module){var s=require("component/popupTip"),o=Backbone.View.extend({el:".update-password-form",events:{"click #submit":"onClickSubmit","change #oldpass":"onChangeOldPass","change #newpass":"onChangeNewPass","change #newpassAgain":"onChangeNewPassAgain"},initialize:function(){this.modifyPasswordTime=$("#modifyPasswordTime"),this.showFirstLoginPopupTip(),this.error=!0},showFirstLoginPopupTip:function(){0==this.modifyPasswordTime.val()&&s.show("首次登陆，请修改密码！","",[{text:"确定",style:"success",handler:function(){this.hide()}}])},onChangeOldPass:function(s){var o=$("#oldpass").val();""==o?(this.showError("oldpass","密码不能为空"),this.error=!0):(this.error=!1,$("#oldpass").css({"border-color":"green"}),$("#oldpassTip").css({display:"none"}))},onChangeNewPass:function(s){var o=$("#newpass").val();""==o?(this.showError("newpass","新密码不能为空"),this.error=!0):(this.error=!1,$("#newpass").css({"border-color":"green"}),$("#newpassTip").css({display:"none"}))},onChangeNewPassAgain:function(s){var o=$("#newpass").val();if(""==o)return this.showError("newpass","新密码不能为空"),void(this.error=!0);var e=$("#newpassAgain").val();e!=o?(this.showError("newpassAgain","与输入的新密码不一致"),this.error=!0):(this.error=!1,$("#newpassAgain").css({"border-color":"green"}),$("#newpassAgainTip").css({display:"none"}))},onClickSubmit:function(o){if(o.preventDefault(),this.onChangeOldPass(),this.onChangeNewPass(),this.onChangeNewPassAgain(),!this.error){var e=$("#username").val(),n=$("#newpass").val(),a=$("#oldpass").val();$.ajax({url:global_config.root+"/update-password",type:"post",data:{userName:e,newPassword:n,oldPassword:a},dataType:"json",success:function(o){0==o.code?(s.show("修改成功，正在重新登录"),setTimeout(function(){location.assign("/j_spring_security_logout")},1e3)):s.show(o.message)}})}},showError:function(s,o){$("#"+s).css({"border-color":"red"}),$("#"+s+"Tip").empty(),$("#"+s+"Tip").append(o),$("#"+s+"Tip").css({display:"inline"})}});exports.UpdatePasswordView=o});