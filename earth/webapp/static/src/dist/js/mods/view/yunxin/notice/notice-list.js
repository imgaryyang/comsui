define(function(require,exports,module){var t=require("component/popupTip"),e=require("baseView/tableContent"),i=require("baseView/baseFormView").FormDialogView,a=jQuery,n=global_config.root,o=window.helpTip,s=i.extend({className:"modal fade form-modal",template:_.template(a("#addNoticeTmpl").html(),{variable:"obj"}),initialize:function(){s.__super__.initialize.apply(this,arguments),this.defineValidator()},defineValidator:function(){this.validator=this.$(".form").validate({rules:{title:"required",content:"required"}})},validate:function(){return this.validator.form()},extractDomData:function(){var t=this._extractDomData(this.$(".real-value"));return t.title=_.escape(t.title),t.content=_.escape(t.content),t},save:function(){var e=this.extractDomData(),i=this,o={url:n+"/notice/notice-add",data:e,type:"post",dataType:"json"};o.success=function(e){0==e.code?(i.hide(),i.trigger("add")):t.show(e.message)},a.ajax(o)},submitHandler:function(){this.validate()&&this.save()}}),l=i.extend({className:"modal fade form-modal",template:_.template(a("#editNoticeTmpl").html(),{variable:"obj"}),events:{"click .menu-item":"onClickMenu","click .save":"onClickSave","click .submit":"onClickSubmit"},initialize:function(){l.__super__.initialize.apply(this,arguments),this.defineValidator();var t=Pagination.extend({refreshTableDataList:function(t,e,i,n){if(this.template){var o;if(t.length<1)o='<tr class="nomore"><td style="text-align: center;" colspan="'+this.rowNum+'">没有更多数据</td></tr>';else var s=_.template(a("#operateTable").html()),o=s({list:t});this.tableListEl.find("tbody").html(o),this.trigger("refresh",t,e,i,n)}}});this.pagination=new t({el:this.$(".sys-log"),pageRecordNum:5}),a(document).on("mouseover",".log-recordContent",function(){var t=a(this);o.setOptions({el:t,txt:a(this).html()}),o.show()}).on("mouseleave",".log-recordContent",function(){o.hide()})},defineValidator:function(){this.validator=this.$(".form").validate({rules:{title:"required",content:"required"}})},validate:function(){return this.validator.form()},onClickMenu:function(t){t.preventDefault();var e=a(t.target),i=this.$(".menu-item"),n=this.$(".form");e.hasClass("active")||(i.removeClass("active"),n.removeClass("hide"),e.addClass("active"),e.hasClass("notice")?(this.$(".notice").show(),this.$(".sys-log").addClass("hide")):e.hasClass("operation")&&(this.$(".sys-log").show(),this.$(".form.adapt.notice").addClass("hide")))},extractDomData:function(){var t=this._extractDomData(this.$(".real-value"));return t.title=_.escape(t.title),t.content=_.escape(t.content),t},save:function(){var t=this.extractDomData();return t.noticeUuid=this.model.get("uuid"),t},onClickSave:function(){if(this.validate()){var e=this,i={url:n+"/notice/notice-edit",data:e.save(),type:"post",dataType:"json"};i.success=function(i){0==i.code?(e.hide(),e.trigger("add")):t.show(i.message)},a.ajax(i)}},onClickSubmit:function(){var e=this,i={url:n+"/notice/notice-release",data:e.save(),type:"post",dataType:"json"};i.success=function(i){0==i.code?(e.hide(),e.trigger("add")):t.show(i.message)},a.ajax(i)}}),r=i.extend({template:_.template(a("#obsoleteTmpl").html()),submitHandler:function(){var t=this.$("[name=remarks]").val();this.trigger("obsolete",t)}}),c=e.extend({events:{"click .btn-primary":"onClickAddNotice","click .edit,.check":"onClickEdit","click .obsolete":"onClickObsolete"},initialize:function(){c.__super__.initialize.apply(this,arguments)},onClickAddNotice:function(t){var e=this,i=new s;i.show(),i.on("add",function(){e.refresh()})},onClickEdit:function(t){t.preventDefault();var e=this,i=a(t.target),n={},o=i.parents("tr");n.title=_.escape(o.find(".title").html()),n.content=_.escape(o.find(".notice-content").html()),n.noticestatus=o.data("noticestatus"),n.uuid=o.data("uuid");var s=new Backbone.Model(n),r=new l({model:s});r.show(),r.on("add",function(){e.refresh()})},onClickObsolete:function(t){t.preventDefault(),target=a(t.target);var e=new r;e.show();var i=this;e.on("obsolete",function(t){var o={},s=target.parents("tr").data("uuid");o.noticeUuid=s,o.remarks=t;var l={url:n+"/notice/notice-invalid",data:o,dataType:"json",type:"post"};l.success=function(t){0==t.code&&(e.hide(),i.refresh())},a.ajax(l)})}});exports.NoticeListView=c});