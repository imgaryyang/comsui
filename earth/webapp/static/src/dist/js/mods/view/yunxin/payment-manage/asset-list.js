define(function(require,exports,module){var t=require("baseView/tableContent"),e=(require("component/popupTip"),jQuery),o=global_config.root,a=t.extend({action:{getRepaymentInfo:function(t){return o+"/repaymentPlan/query/"+t+"/repaymentInfo"}},events:{"click .text-overflow":function(t){if(window.getSelection){var o=document.createRange();o.selectNode(e(t.target)[0]),window.getSelection().addRange(o),document.execCommand("Copy")}},"mouseover .showPopover":"showPopover","mouseout .showPopover":"closePopover"},initialize:function(){a.__super__.initialize.apply(this,arguments),this.$showPopover=e(".statistical-amount"),this.listenTo(this,"show-popover:amountStatistics",this.showAmountStatisticsPopover)},showAmountStatisticsPopover:function(t){t&&this.queryAmountStatistics()},queryAmountStatistics:function(){var t=this.collectParams(),o={type:"post",dataType:"json",url:global_config.root+"/assets/amountStatistics",data:t};o.success=function(t){var e=this.$showPopover.data("bs.popover");if(0==t.code){var o=0,a=0,n=0;_.isEmpty(t.data)||(o=t.data.plannedAmount.formatMoney(2,""),a=t.data.actualAmount.formatMoney(2,""),n=t.data.differenceAmount.formatMoney(2,""));var s='<div><span class="text-muted">应还款金额:</span>'+o+'<br/><span class="text-muted">实际还款金额:</span>'+a+'<br/><span class="text-muted">差值:</span>'+n+"</div>";e.options.content=s}else e.options.content=t.message;this.$showPopover.popover("show")}.bind(this),e.ajax(o)},showPopover:function(t){t.preventDefault();var o=this,a=e(t.target),n=a.parent("td").data("asset-set-id");this.timer=setTimeout(function(){var t={dataType:"json",url:o.action.getRepaymentInfo(n)};t.success=function(t){a.popover({content:function(){return 0==t.code?'<div><span class="text-muted">计划还款本金:</span>'+(+t.data.loanAssetPrincipal).formatMoney(2,"")+'<br/><span class="text-muted">计划还款利息:</span>'+(+t.data.loanAssetInterest).formatMoney(2,"")+' <br/><span class="text-muted">贷款服务费:</span>'+(+t.data.loanServiceFee).formatMoney(2,"")+'<br/><span class="text-muted">技术维护费:</span>'+(+t.data.loanTechFee).formatMoney(2,"")+'<br/><span class="text-muted">其他费用:</span>'+(+t.data.loanOtherFee).formatMoney(2,"")+'<br/><span class="text-muted">逾期费用合计:</span>'+(+t.data.totalOverDueFee).formatMoney(2,"")+"<br/></div>":"<div>"+t.message+"</div>"}}),a.popover("toggle")},e.ajax(t)},300)},closePopover:function(t){t.preventDefault(),clearTimeout(this.timer),e("body").find(".popover").popover("hide")}});module.exports=a});