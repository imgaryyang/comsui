define(function(require,exports,module){var t=require("baseView/tableContent"),e=jQuery,a=t.extend({initialize:function(){a.__super__.initialize.call(this,arguments),this.$showPopover=e(".statistical-amount"),this.listenTo(this,"show-popover:amountStatistics",this.showAmountStatisticsPopover)},events:{"mouseover .showPopover":"onShowPopover","mouseout .showPopover":"onClosePopover"},showAmountStatisticsPopover:function(t){t&&this.queryAmountStatistics()},queryAmountStatistics:function(){var t=this.collectParams(),a={dataType:"json",url:global_config.root+"/payment-manage/order/paymentAmountStatistics",data:t};a.success=function(t){var e=this.$showPopover.data("bs.popover");if(0==t.code){var a=0,s=0,o=0,n=0;_.isEmpty(t.data)||(a=t.data.plannedAmount,s=t.data.penaltyAmount,o=t.data.paymentAmount,n=t.data.totalOverdueFee,a=a.formatMoney(2,""),s=s.formatMoney(2,""),o=o.formatMoney(2,""),n=n.formatMoney(2,""));var r='<div><span class="text-muted">计划还款本金:</span>'+a+'<br/><span class="text-muted">计划还款利息:</span>'+s+'<br/><span class="text-muted">差异罚息:</span>'+o+'<br/><span class="text-muted">结算金额:</span>'+n+"</div>";e.options.content=r}else e.options.content=t.message;this.$showPopover.popover("show")}.bind(this),e.ajax(a)},onShowPopover:function(t){var a=e(t.target),s=a.parent().data("order-id");this.timer=setTimeout(function(){var t={url:global_config.root+"/payment-manage/order/"+s+"/chargesDetail",dataType:"json"};t.success=function(t){a.popover({content:function(){if(0==t.code){if(e.isEmptyObject(t.data))return'<div><span class="text-muted">还款本金: -</span><br/><span class="text-muted">还款利息: -</span><br/><span class="text-muted">贷款服务费: -</span><br/><span class="text-muted">技术维护费: -</span><br/><span class="text-muted">其他费用: -</span><br/><span class="text-muted">逾期罚息: -</span><br/><span class="text-muted">逾期违约金: -</span><br/><span class="text-muted">逾期服务费: -</span><br/><span class="text-muted">逾期其他费用: -</span><br/><span class="text-muted">逾期费用合计: -</span><br/></div>';var a=0,s=0,o=0,n=0,r=0,p=0,i=0,m=0,u=0,d=0;if(!_.isEmpty(t.data.data)){var c=t.data.data;a=c.loanAssetPrincipal,s=c.loanAssetInterest,o=c.loanServiceFee,n=c.loanTechFee,r=c.loanOtherFee,p=c.overdueFeePenalty,i=c.overdueFeeObligation,m=c.overdueFeeService,u=c.overdueFeeOther,d=p+i+m+u}return'<div><span class="text-muted">还款本金:</span>'+(+a).formatMoney(2,"")+'<br/><span class="text-muted">还款利息:</span>'+(+s).formatMoney(2,"")+'<br/><span class="text-muted">贷款服务费:</span>'+(+o).formatMoney(2,"")+'<br/><span class="text-muted">技术维护费:</span>'+(+n).formatMoney(2,"")+'<br/><span class="text-muted">其他费用:</span>'+(+r).formatMoney(2,"")+'<br/><span class="text-muted">逾期罚息:</span>'+(+p).formatMoney(2,"")+'<br/><span class="text-muted">逾期违约金:</span>'+(+i).formatMoney(2,"")+'<br/><span class="text-muted">逾期服务费:</span>'+(+m).formatMoney(2,"")+'<br/><span class="text-muted">逾期其他费用:</span>'+(+u).formatMoney(2,"")+'<br/><span class="text-muted">逾期费用合计:</span>'+(+d).formatMoney(2,"")+"<br/></div>"}return"<div>"+t.message+"</div>"}}),a.popover("toggle")},e.ajax(t)},300)},onClosePopover:function(t){t.preventDefault(),clearTimeout(this.timer),e("body").find(".popover").popover("hide")}});module.exports=a});