define(function(require,exports,module){var e=require("component/popupTip"),a=require("baseView/tableContent"),t=jQuery,c=global_config.root,o=Backbone.Model.extend({echarge:function(e){var a=this,o={remark:e,sourceDocumentUuid:this.get("sourceDocumentUuid")},n={dataType:"json",url:c+"/capital/customer-account-manage/deposit-receipt-list/recharge-cancel",data:o};n.success=function(e){0==e.code&&a.set({revocationSourceDocumentNo:o.sourceDocumentNo}),a.trigger("echarge:success",e)},n.complete=function(){a.trigger("echarge:complete")},this.trigger("echarge:start"),t.ajax(n)}}),n=a.extend({events:{"click .echarge-cancel":"onClickCancelEcharge"},packParams:function(e){var a={};return a.sourceDocumentUuid=e.data("uuid"),a.rechargeSourceDocumentNo=e.data("sourcedocumentno"),a.bookingAmount=e.data("bookingamount"),a.virtualAccountName=e.data("virtualaccountname"),a.virtualAccountNo=e.data("virtualaccountno"),a.revocationSourceDocumentNo="",a},onClickCancelEcharge:function(a){a.preventDefault();var n=t(a.target);if(!n.is(".disabled")){var s=this,r=this.packParams(n.parents("tr")),i=new o(r);i.on("echarge:start",function(){n.addClass("disabled")}),i.on("echarge:success",function(a){0==a.code?(e.show('<div class="cancel-success" ><p class="tip" style="margin-top:10px;">撤销单<span class="important">'+a.data.sourceDocumentNo+'</span>已创建</p><p class="tip">请前往查询撤销结果状态</p></div>'),s.query()):"余额不足"===a.message?e.show('<div class="cancel-failure"><p class="tip" style="margin-top:10px;"><span class="important">余额不足</span></p><p class="tip">请先将余额支付退款至余额</p></div>',null,[{text:"确定",style:"submit",handler:function(){location.href=c+"/capital/customer-account-manage/payment-order-list/show#status=-1&pageIndex=1&key="+i.get("virtualAccountNo")}}]):e.show(a.message)}),i.on("echarge:complete",function(){n.removeClass("disabled")});var u=_.template(t("#EchargeCancelDialogTmpl").html());e.show(u(i.toJSON()),"作废",[{text:"关闭",style:"default",handler:function(){this.hide()}},{text:"确定",style:"success",handler:function(){var e=t("#remark").val();i.echarge(e)}}])}}});module.exports=n});